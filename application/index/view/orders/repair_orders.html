<!--nav-->
{include file="public/header" }

<link href="__PUBLIC__static/index/css/select2.css" rel="stylesheet" />
<script src="__PUBLIC__static/index/js/select2.js"></script>
<script type="text/javascript" src="__PUBLIC__static/admin/webupload/webuploader.min.js"></script>
<script src="__CITY__/distpicker.data.js"></script>
<script src="__CITY__/distpicker.js"></script>
<script src="__CITY__/main.js"></script>
<link rel="stylesheet" type="text/css" href="__PUBLIC__static/admin/webupload/webuploader.css">

<link rel="stylesheet" type="text/css" href="__PUBLIC__static/admin/webupload/style.css">
<style>
    .btn-numbox {

        margin-top: 0px;
    }
    .btn-numbox li {
        float: left;
    }
    .btn-numbox li .number,
    .kucun {
        display: inline-block;
        font-size: 12px;
        color: #808080;
        vertical-align: sub;
    }
    .btn-numbox .count {
        overflow: hidden;
        margin: 0 16px 0 -20px;
    }
    .btn-numbox .count .num-jian,
    .input-num,
    .num-jia {
        display: inline-block;
        width: 28px;
        height: 32px;
        line-height: 28px;
        text-align: center;
        font-size: 18px;
        color: #999;
        cursor: pointer;
        border: 1px solid #e6e6e6;
    }

    .btn-numbox .count .num-jia {
        margin-left: 1px;
    }

    .btn-numbox .count .input-num {
        width: 58px;
        height: 32px;
        color: #333;
        border-left: 0;
        border-right: 0;
    }
    .xin{
        position: relative;
        top: 3px;
    }
    @media (min-width: 776px ) {
        .metaclass{
            margin-top: 60px;
        }
    }
    .file-item {
        float: left;
        position: relative;
        width: 110px;
        height: 110px;
        margin: 0 20px 20px 0;
    }

    .file-item .info {
        overflow: hidden;
    }

    .uploader-list {
        width: 100%;
        overflow: hidden;
    }

    .webuploader-pick {
        position: relative;
        display: inline-block;
        cursor: pointer;
        background: #fff;
        padding: 10px 15px;
        color: #fff;
        text-align: center;
        border-radius: 3px;
        overflow: hidden;
    }

    .dele1 {
        line-height: 40px;
    }

    .count * {
        line-height: 28px;
    }

    .j {
        border-bottom: 1px solid #dddddd;
        margin: 0px 0px 0px -10px;
    }

    .jk {
        padding: 10px 10px 10px 10px;
    }

    .l_lin {
        padding-top: 30px;
    }

    .jkdele1 {
        padding-top: 20px;
    }
</style>

<style>

</style>

<form autocomplete="off" id="myForm" class="" method="post" action="__PUBLIC__orders/placeorder">

    <div class="container main">
        <h5 class="page-header bx">
            <span>当前位置：</span>
            <small>维修下单</small>
            <span>>></span>
        </h5>
        <div class="The-test-panel-head">
            <span class="ml-10">维修下单</span>
        </div>
        <div class="The-test-panel-body" style="position: relative;">
            <div class="" style="line-height: 40px">
                <?php if(empty($_SESSION['think']['ds_username'])){ ?>
                <div class="row">
                    <label style="float:left;" class="pl-50">您还未登录,登录后给您更好的服务</label>
                    <div class="col-md-6 pl-40 ">
                        <a href="__PUBLIC__auth" class="text-orange">登录>></a>
                    </div>
                </div>
                <div class="j"></div>
                <?php } ?>
                <div class="row mt-10">
                    <!--客户信息-->
                    <!-- 未登入状态 -->
                    <?php if(empty($_SESSION['think']['ds_username'])): ?>

                    <div class="col-md-6 hidden">
                        <div>
                            <label style="float:left;">您还未登录,登录后给您更好的服务</label>
                            <div class="col-md-6 pl-40 ">
                                <a href="__PUBLIC__auth" class="text-orange">登录>></a>
                            </div>
                        </div>
                        <div class="row hidden">
                            <div class="col-md-3">
                                <label>您还未登录,登录后给您更好的服务</label>
                                <a href="__PUBLIC__auth" class="form-control text-orange">
                                    登录
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6"></div>
                    <!-- 登入后的状态 -->
                    <?php else: ?>
                    <div class="col-md-6">
                        <div class="row">
                            <label class="col-md-3 col-xs-12">客户ID </label>
                            <div class="col-md-8 col-xs-10">
                                <input type="text" readonly unselectable="on" id="client" name="uid" class="form-control ds-uid" value="<?php echo $_SESSION['think']['id'] ?>">
                                <input type="text" style="display:none" id="uname" name="uname" class="form-control ds-uid" value="<?php echo $_SESSION['think']['ds_username'] ?>">
                            </div>
                        </div>
                    </div>
                    <?php endif; ?>
                    <!--预约开始时间-->

                    <div class="col-md-6">
                        <div class=" row">
                            <label class="col-md-3 col-xs-12" name="market_cer">商城名称</label>
                            <div class="col-md-8 col-xs-10">
                                <input type="text" autocomplete="off" name="designation" id="designation" class="form-control">
                            </div>
                            <label class="col-xs-1">
                                <b class='text-orange xin'>*</b>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <!--联系人-->
                    <div class="col-md-6">
                        <div class="row">
                            <label class="col-md-3 col-xs-12">联系人</label>
                            <div class="col-md-8 col-xs-10">
                                <input type="text" name="linkman_contacts" id="linkman_contacts" class="form-control" value="{$loaction.name}">
                            </div>
                            <label class="col-xs-1">
                                <b class='text-orange xin'>*</b>
                            </label>
                        </div>
                    </div>


                    <!--目标维修地址-->
                    <div class="col-md-6">
                        <div class="row">
                            <label for="input_date" class="col-md-3 col-xs-12">预约施工时间</label>
                            <div class="col-md-8 col-xs-10">
                                <div class="input-append date form_datetime" id="input_date" data-date="2013-02-21T15:25:00Z">
                                    <input class="layui-input"  autocomplete="off" id="form_datetime" class="form-control" placeholder="" name="input_date" onclick="layui.laydate({elem: this, format:'YYYY-MM-DD hh:mm:ss',istime: true,min: laydate.now()})">

                                    <span class="add-on"><i class="icon-remove"></i></span>
                                    <span class="add-on"><i class="icon-calendar"></i></span>
                                </div>
                            </div>
                            <label class="col-xs-1">
                                <b class='text-orange xin'>*</b>
                            </label>
                        </div>
                    </div>


                </div>
                <div class="row">
                    <!--联系电话-->
                    <div class="col-md-6">
                        <div class="row">
                            <label class="col-md-3 col-xs-12">联系电话</label>
                            <div class="col-md-8 col-xs-10">
                                <input type="text" autocomplete="off" name="telephone" id="telephone" class="form-control" value="{$loaction.phone}">
                            </div>
                            <label class="col-xs-1">
                                <b class='text-orange xin'>*</b>
                            </label>
                        </div>

                    </div>
                    <?php if($loaction['province']==''):?>
                    <div class="col-md-6">
                        <div class="row">
                            <label class="col-md-3 col-xs-12">维修地址</label>
                            <div class="col-md-8 col-xs-10">
                                <div id="distpicker5" class="row">

                                    <div class="col-md-4 mb-10">
                                        <label class="sr-only" for="province10">Province</label>
                                        <select class="form-control" id="province10" name="province">
                                        </select>
                                    </div>

                                    <div class="col-md-4 mb-10">
                                        <label class="sr-only" for="city10">City</label>
                                        <select class="form-control" id="city10" name="city">
                                        </select>
                                    </div>

                                    <div class="col-md-4 mb-10">
                                        <label class="sr-only" for="district10">District</label>
                                        <select class="form-control" id="district10" name="district">
                                        </select>
                                    </div>
                                </div>

                            </div>
                            <label class="col-xs-1"><b class='text-orange xin'>*</b></label>
                        </div>
                    </div>
                    <?php else:?>
                    <div class="col-md-6">
                        <div class="row">
                            <label class="col-md-3 col-xs-12">维修地址</label>
                            <div class="col-md-8 col-xs-10">
                                <div class="row" >
                                    <div class="col-md-12">
                                        <input type="hidden"  style="border:none;background:#fff"  class='form-control' name="province" id="province10" value="{$loaction.province}">
                                        <input type="hidden" style="border:none;background:#fff"  class='form-control' name="district" id="district10" value="{$loaction.district}">
                                        <input type="hidden" style="border:none;background:#fff"   class='form-control' name="city" id="city10" value="{$loaction.city}">
                                        <span id="ds_u_pro">{$loaction.province}</span>
                                        <span id="ds_u_cit">{$loaction.city}</span>
                                        <span id="ds_u_dis">{$loaction.district}</span>
                                        <span id="ds_u_ars">{$loaction.location}</span>
                                        <a class="ds_add_dizhi" style="cursor: pointer;">使用新地址</a>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                    <?php endif;?>






                </div>
                <div class="row pb-20">
                    <div class="col-md-6"></div>
                    <?php if($loaction['province']==''):?>
                    <div class="col-md-6">
                        <div class="row">
                            <label class="col-md-3 col-xs-12"></label>
                            <div class="col-md-8 col-xs-10">
                                <input type="text" autocomplete="off" name="address" id="address" placeholder="请输入详细地址，精确到街道、门牌号" class="form-control">
                            </div>
                            <label class="col-xs-1"><b class='text-orange xin'>*</b></label>
                        </div>
                    </div>
                    <?php else:?>
                    <div class="col-md-6">
                        <div class="row">
                            <label class="col-md-3 col-xs-12" name="market_cer"></label>
                            <div class="col-md-6">
                                <input type="hidden" class='form-control' style="border:none;background:#fff"   name="address" id="address" value="{$loaction.location}">
                            </div>

                        </div>
                    </div>
                    <?php endif;?>
                </div>
            </div>
            <div class="j"></div>
            <div class="dele1" id="show1">
                <!--服务类别-->

            </div>
            <div class="row j jk l_lin  Increase_the_project_title">
                <div class="col-md-5 pl-40">
                    <input value="增加维修项目" type="button" class="btn border-radius mb-10 btn-success" id="increase">
                </div>
            </div>

            <div class="row l_lin">
                <!--商场办证-->
                <div class="col-md-2  col-xs-12">
                    商场办证 <b class='text-orange xin'>*</b>
                </div>
                <div class="col-md-2 col-xs-12">
                    <div class="radio mt-0  radio-success">
                        <input value="1" type="radio" id="master_worker" checked name="departure_card">
                        <label for="master_worker">
                            师傅代办
                        </label>
                    </div>
                </div>
                <div class="col-md-2 col-xs-12">
                    <div class="radio mt-0 radio-success">
                        <input value="2" type="radio" id="clientele" name="departure_card">
                        <label for="clientele">
                            客户办理
                        </label>
                    </div>
                </div>
                <div class="col-md-2 col-xs-12">
                    <div class="radio mt-0 radio-success">
                        <input value="3" type="radio" id="do_without" name="departure_card">
                        <label for="do_without">
                            不需要办证
                        </label>
                    </div>
                </div>
            </div>
			<div class="row pb-20 l_lin">
                <div class="col-md-2">
                    <label class="btn btn-default">维修验收单(图)</label>
                </div>
                <div class="col-md-3" id="imgysd" style="margin-left:1%">
                    <input type="hidden" id="ds_ysd" name="ysimg">
                    <img id="img_ysd" class="mt-0_xs" style="width: 200px;height: 200px" src="__PUBLIC__static/index/images/tj.png" />
                </div>
            </div> 
            <div class="row l_lin">
                <div class="col-md-2">
                    <label class="btn btn-default">门头照片</label>
                </div>
                <div class="col-md-6" id="imgPickers">
                    <input type="hidden" id="data_photos" name="aimg">
                    <img id="img_datas" class="mt-0_xs" style="width: 200px;height: 200px" src="__PUBLIC__static/index/images/tj.png" />
                </div>
            </div>
            <div class="j"></div>
            <!--需求-->
            <div class="row j pb-20">
                <div class="col-md-12 mt-20">
                    <div class="checkbox-warning checkbox">
                        <input type="checkbox"  value="1"   id="nuclear_list_in_advance">
                        <label for="nuclear_list_in_advance">
                            需现场调查，进一步核实
                        </label>
                    </div>
                </div>
                <div class="col-md-3 mt-20">
                    <div class="checkbox checkbox-primary">
                        <input type="checkbox"  id="ds-s"    value="" >
                        <label for="ds-s">
                            使用平台月结服务
                        </label>
                    </div>
                    <input type="password" autocomplete="off"  name="pwd" placeholder="月结客户使用的密码" id="year_service_ordere_pwd" class="form-control" style="opacity: 0">
                </div>
            </div>
            <div class="row pt-20">
                <!--协议-->
                <div class="col-xs-6 " style="color:red;">
                    注： <b class='text-orange xin'>*</b> 表示必填项
                </div>
            </div>
        </div>
        <input id="ds-sub" name="ds_step" hidden="hidden" value="">
        <input id="judge" name="judge" hidden="hidden" value="">
        <!--同意协议-->
        <input value="0" id="ds_hedan" name="hedan" hidden="hidden">
        <input value="0" id="ds_yue" name="yue" hidden="hidden">
        <?php if(empty($_SESSION['think']['type'])) :?>
        <?php else: ?>
        <input value="<?php echo $_SESSION['think']['type']; ?>" id="ds_worker_type" name="ds_worker_type" hidden>
        <?php endif ?>
        <div class="row">
            <div class="col-md-12 mt-10">
                <a id="yezhuxieyi" href="javascript:;" class="" id="yz">《业主协议》</a>
                <div class="checkbox checkbox-success" style="display:inline-block;">
                    <input type="radio" id="agreement">
                    <label for="agreement">
                        我同意协议
                    </label>
                </div>
            </div>
        </div>
        <div class="row pb-20 pl-10">
            <div class="col-md-3 col-sm-4 col-xs-6 col-sm-offset-1 text-center mt-20">
                <button id="xiandan" disabled="display" lay-submit="" lay-filter="demo1" style="width: 100%" class="btn btn-success  border-radius ">直接下单</button>
            </div>
            <input type="hidden" id="step_type" value="" name="step_type">
            <div class="col-md-3 col-md-offset-4  col-sm-4 col-xs-6 text-center mt-20">
                <input type="submit" disabled="display" id="quick_consulting" class="btn btn-blue form-control border-radius " value="快捷咨询">
            </div>
        </div>
    </div>
</form>
<script>
    $(".ds_add_dizhi").click(function () {
        var uid=$('#ds_uid').val();
        var layer=layui.layer;
        var  url="__PUBLIC__/client_location";
        parent.layer.open({
            type:2,
            area:["800px","650px"],
            title:" ",
            shade:0,
            content: ['__PUBLIC__/client_location', 'no'],
            scrollbar:false,
            end: function() {
                ds_show();
            },
            success:function (inde) {
            }
        });
    });
</script>
<script type="text/javascript">
    function ds_show(){
        $.get("__PUBLIC__api_uid_address", function(data) {
            $('#linkman_contacts').val(data.name);
            $('#telephone').val(data.phone);

            $('#province10').val(data.province);
            $('#city10').val(data.city);
            $('#district10').val(data.district);
            $('#address').val(data.location);

            $('#ds_u_pro').html(data.province);
            $('#ds_u_cit').html(data.city);
            $('#ds_u_dis').html(data.district);
            $('#ds_u_ars').html(data.location);


        }, "json" );
    }

</script>
<script>
    $(function () {
//        自动添加默认开始值
        var  i=1;
        var zidongzengjia=function () {

//            自动添加加载模版
            var html='{include file="public/zsa" }';
//            添加图片正则替换
            html=html.replace(/imgPicker/g,"imgPicker"+i);
//            渲染
            $("#show1").append(html);
            automatically(i);
            i++;

        }
//        自动添加按钮点击事件
        $("#increase").click(function(
        	
        	){
        	zidongzengjia();
        });
        zidongzengjia()
        //加
        $("#show1").on("click",".num-jian",function () {
            var m=  $(this).parent().siblings("li").find(".input-num").val();
            if(m==""){
                m=0;
            }
            if(m>0){
                m--;
            }
            $(this).parent().siblings("li").find(".input-num").val(m)
        })
        //减
        $("#show1").on("click",".num-jia",function () {
            var m=  $(this).parent().siblings("li").find(".input-num").val();
             if(m==""){
                m=0;
            }
            m++;
            $(this).parent().siblings("li").find(".input-num").val(m)
        });
        //服务大类
        $("#show1").on("change",".product_categories",function () {
            var va=$(this).val();
            var thise=$(this);
            var his=$(this).parent().parent().parent().parent().next().find(".product_categoriesx_xiao");
            
            $.getJSON("__PUBLIC__orders/twostclass",{bigname:va},function(json){
                //清空原有的选项
                his.html("");
                $.each(json,function(index,array){
                    var option = "<option value='"+array['id']+"'>"+array['name']+"</option>";
                    his.append(option);
                });
                var awr=$(thise).parent().parent().parent().parent().next().find(".product_categoriesx_xiao").val()
                $.getJSON("__PUBLIC__orders/threestclass",{bigname:awr},function(json){
                    var smallname=his.parent().parent().parent().parent().next().next().next().find(".site_survey_measurement");
                    smallname.html(''); //清空原有的选项
                    $.each(json,function(index,array){
                        var option = "<div style='display: inline-block' class='checkbox checkbox-success'><input type='checkbox'  name='site_survey_measurement[]' id='"+array['id']+"' value='"+array['id']+"'><label for=''>"+array['name']+"</label></div>&nbsp;";
                        smallname.append(option);
                    });
                });
            });
        });
        //服务小类
        $("#show1").on("change",".product_categoriesx_xiao",function () {
            var thi=$(this);
            $.getJSON("__PUBLIC__orders/threestclass",{bigname:$(this).val()},function(json){
                var smallname=thi.parent().parent().parent().parent().next().next().next().find(".site_survey_measurement");
                
               
                smallname.html(''); //清空原有的选项
                $.each(json,function(index,array){
                    var option = "<div style='display: inline-block' class='checkbox checkbox-success'><input type='checkbox'  name='site_survey_measurement[]' id='"+array['id']+"' value='"+array['id']+"'><label for=''>"+array['name']+"</label></div>&nbsp;";
                    smallname.append(option);
                });
            });
        });
        //我同意

        $("#agreement").click(function () {

            if ($(this).prop("checked")) {
                $(this).prop("checked", true);
                $("#xiandan").prop("disabled", false);
                $("#quick_consulting").prop("disabled", false);
            } else {
                $(this).prop("checked", false);
                $("#xiandan").prop("disabled", true);
                $("#quick_consulting").prop("disabled", true);
            }
        });

        $("#ds-s").change(function () {
            if ($(this).prop("checked") === true) {
                $("#year_service_ordere_pwd").css("opacity", '1');
                $("#quick_consulting").css("opacity", "0");
                $('#ds_yue').val(1);
            } else {
                $("#year_service_ordere_pwd").css("opacity", '0');
                $("#quick_consulting").css("opacity", "1");
                $('#ds_yue').val(0);
            }
        });
        $("#xiandan").click(function () {
            $("#ds-sub").val(1);
            $("#judge").val(1);
        })
        $("#quick_consulting").click(function () {
            $("#ds-sub").val(2);
        })
        function automatically(i) {

            WebUploader.create({
                auto: true,// 选完文件后，是否自动上传。
                swf: '__PUBLIC__static/admin/webupload/Uploader.swf',// swf文件路径
                server: "{:url('__PUBLIC__/admin/Uploads/dsupload')}",// 文件接收服务端。
                duplicate: true,// 重复上传图片，true为可重复false为不可重复
                pick: '#imgPicker'+i+'a',// 选择文件的按钮。可选。
                accept: {
                    title: 'Images',
                    extensions: 'gif,jpg,jpeg,bmp,png',
                    mimeTypes: 'image/jpg,image/jpeg,image/png'
                },
                'onUploadSuccess': function (file, data, response) {
                    $("#imgPicker"+i+'a').find("input[type=hidden]").val(data._raw);
                    $("#imgPicker"+i+'a').find("img").attr("src","__DsQINiu__"+data._raw);
                    msg("添加成功",1);
                },

            });
            WebUploader.create({
                auto: true,// 选完文件后，是否自动上传。
                swf: '__PUBLIC__static/admin/webupload/Uploader.swf',// swf文件路径
                server: "{:url('__PUBLIC__/admin/Uploads/dsupload')}",// 文件接收服务端。
                duplicate: true,// 重复上传图片，true为可重复false为不可重复
                pick: '#imgPicker'+i+'c',// 选择文件的按钮。可选。
                accept: {
                    title: 'Images',
                    extensions: 'gif,jpg,jpeg,bmp,png',
                    mimeTypes: 'image/jpg,image/jpeg,image/png'
                },
                'onUploadSuccess': function (file, data, response) {
                    $("#imgPicker"+i+'c').find("input[type=hidden]").val(data._raw);
                    $("#imgPicker"+i+'c').find("img").attr("src","__DsQINiu__"+data._raw);
                    msg("添加成功",1);
                },

            });
            WebUploader.create({
                auto: true,// 选完文件后，是否自动上传。
                swf: '__PUBLIC__static/admin/webupload/Uploader.swf',// swf文件路径
                server: "{:url('__PUBLIC__/admin/Uploads/dsupload')}",// 文件接收服务端。
                duplicate: true,// 重复上传图片，true为可重复false为不可重复
                pick: '#imgPicker'+i+'b',// 选择文件的按钮。可选。
                accept: {
                    title: 'Images',
                    extensions: 'gif,jpg,jpeg,bmp,png',
                    mimeTypes: 'image/jpg,image/jpeg,image/png'
                },
                'onUploadSuccess': function (file, data, response) {
                    $("#imgPicker"+i+'b').find("input[type=hidden]").val(data._raw);
                    $("#imgPicker"+i+'b').find("img").attr("src","__DsQINiu__"+data._raw);
                    msg("添加成功",1);
                },

            });
           
            $(".js-example-tags").select2({tags: true});
            $(".select2-container").css("width", "100%");
            $(".select2-selection").css("border","none")
            $(".select2").addClass("form-control").css({
            });
            $(".select2-selection__rendered").css("margin-top","-3px");
        }
        $('#nuclear_list_in_advance').click(function () {
            if ($(this).prop("checked") === true) {
                $('#ds_hedan').val(1);
            } else {
                $('#ds_hedan').val(0);
            }
        })
    });
    WebUploader.create({
        auto: true,// 选完文件后，是否自动上传。
        swf: '__PUBLIC__static/admin/webupload/Uploader.swf',// swf文件路径
        server: "{:url('__PUBLIC__/admin/Uploads/dsupload')}",// 文件接收服务端。
        duplicate: true,// 重复上传图片，true为可重复false为不可重复
        pick: '#imgPickers',// 选择文件的按钮。可选。
        accept: {
            title: 'Images',
            extensions: 'gif,jpg,jpeg,bmp,png',
            mimeTypes: 'image/jpg,image/jpeg,image/png'
        },
        'onUploadSuccess': function (file, data, response) {
            $("#data_photos").val(data._raw);
            $("#img_datas").attr('src', '__DsQINiu__' + data._raw).show();
            msg("添加成功",1);
        },

    });
	
	   WebUploader.create({
        auto: true,// 选完文件后，是否自动上传。
        swf: '__PUBLIC__static/admin/webupload/Uploader.swf',// swf文件路径
        server: "{:url('__PUBLIC__/admin/Uploads/dsupload')}",// 文件接收服务端。
        duplicate: true,// 重复上传图片，true为可重复false为不可重复
        pick: '#imgysd',// 选择文件的按钮。可选。
        accept: {
            title: 'Images',
            extensions: 'gif,jpg,jpeg,bmp,png',
            mimeTypes: 'image/jpg,image/jpeg,image/png'
        },
        'onUploadSuccess': function (file, data, response) {
            $("#ds_ysd").val(data._raw);
            $("#img_ysd").attr('src', '__DsQINiu__' + data._raw).show();
            msg("添加成功",1);
        },

    });
	
	
    $(".js-example-tags").select2({tags: true});
    $(".select2-container").css("width", "100%");
    $(".select2-selection").css("border","none")
    $("#select2-brand-container").addClass("form-control").css({
        lineHeight:"22px"
    });
    $("#yezhuxieyi").click(function () {
        var   layer=layui.layer;
        parent.layer.open({
            type:2,
            title:"业主协议",
            btn:['我同意',"我再看看"],
            content:" __PUBLIC__yezhuxieyi",
            area:["80%","80%"],
            yes:function(index,layero){
                $("#agreement").prop("checked",'true');
                layer.close(index);
                $("#xiandan").prop("disabled",false);
                $("#quick_consulting").prop("disabled",false);
            },
            btn2:function(index,layero){
                $("#agreement").prop("checked",false);
                layer.close(index);
                $("#xiandan").prop("disabled",true);
                $("#quick_consulting").prop("disabled",true);
            }
        })

    });
    
    // 缓存机制
    window.localStorage.setItem("input-num", 0);
    window.onload = function () {
        // window.localStorage.clear();
        //      保存数据：localStorage.setItem(key,value);
        //      读取数据：localStorage.getItem(key);
        //      删除单个数据：localStorage.removeItem(key);
        //      删除所有数据：localStorage.clear();
        //      得到某个索引的key：localStorage.key(index);
        function savelocalStorage(key, value) {
            window.localStorage.setItem(key, value);
        }
        function addlocalStorage(id) {
            $('#' + id).on('change', function () {
                var brand = $(this).val();
                savelocalStorage(id, brand);
                console.log(window.localStorage);
            });
        }
        function setVal(id) {

            val = localStorage.getItem(id);
            if (localStorage.getItem('input-num') == '') {
                val = 0;
            }
            $('#' + id).val(val);
        }
        if (window.localStorage) {
            setVal('brand');
            setVal('marquey');
            setVal('input-num');
            setVal('malfunction');
            setVal('');
            
            setVal('designation');
            addlocalStorage('brand');
            addlocalStorage('marquey');
            addlocalStorage('input-num');
            addlocalStorage('');
            addlocalStorage('malfunction');
            
            addlocalStorage('designation');
        }else{}
    }
    //控制隐藏元素开启
    $(document).ready(function () {
       
        



        $('#myForm').ajaxForm({
            beforeSubmit: checkForm, // 此方法主要是提交前执行的方法，根据需要设置
            success: complete, // 这是提交后的方法
            dataType: 'json'
        });
        function checkForm() {
            var ds_types=$("#ds_worker_type").val();
            if(ds_types==2){
                msg('您是师傅,不能下单',2);
                return false;
            }
            var designation=alertmsg.msgk("designation","商城名称不能为空");
            if(!designation){
                return false;
            }
            var  form_datetime= alertmsg.msgk("form_datetime","请填写预约施工时间")
            if(!form_datetime){
                return false;
            }
            var linkman_contacts=alertmsg.msgk("linkman_contacts","请填写联系人");
            if(!linkman_contacts){
                return false;
            }
            var telephone=alertmsg.msgk("telephone","请填写联系人电话");
            if(!telephone){
                return false;
            }
            if(!(/^1[34578]\d{9}$/.test($("#telephone").val()))){

                layer.msg('手机号格式不正确，请重新输入手机号码', { icon: 2, time: 1500, shade: 0 }, function (index) {
                    layer.close(index);
                });
                $("#telephone").focus()
                return false;
            }
            var province10=alertmsg.msgk("province10","请输入目标维修地址");
            if(!province10){
                return false;
            }
            var city10=alertmsg.msgk("city10","请输入维修地址");
            if(!city10){
                return false;
            }
            var city10=alertmsg.msgk("city10","请输入维修地址");
            if(!city10){
                return false;
            }

            var district10=alertmsg.msgk("district10","请输入维修地址");
            if(!district10){
                return false;
            }
            var address=alertmsg.msgk("address","请输入详细地址，精确到街道、门牌号");
            if(!address){
                return false;
            }
            
            if($("#ds-s").prop("checked")){
                var year_service_ordere_pwd=alertmsg.msgk("year_service_ordere_pwd","请填写月结客户密码");
                if(!year_service_ordere_pwd){
                    return false;
                }
            }
        }
        function complete(data) {
            var layer=layui.layer;
            var dsurl = $('#ds-sub').val();
            if (data.code == 200) {
                var jump = data.msg;
                if (dsurl == 1) {
                    if($("#ds-s").prop("checked")){
                        window.location.href = "__PUBLIC__month_order/";
                    }else{
                        window.location.href = "__PUBLIC__jilt_single/" + jump;
                    }

                } else {
                    window.location.href = "__PUBLIC__choose/" + jump + "/wid/0";
                }
            } else if (data.code == -1) {
                layer.open({
                    content:"你还未登录还不能开始下单,是否去登录账号",
                    btn:['登录', '我在看看'],
                    title:"登录",
                    shade:0,
                    yes:function () {
                        window.location.href = "__PUBLIC__auth";
                    }
                })

            } else if(data.code==0) {
                layer.open({
                    content: data.msg+'是否前去申请月结客户'
                    ,btn: ['申请月结客户', '我在看看'],
                    title:"申请月结客户",
                    shade:0,
                    skin:"layui-layer-lan"
                    ,yes: function(index, layero){
                        //按钮【按钮一】的回调
                        window.location.href="__PUBLIC__core/customer";
                    }
                });
                return false;
            }else{
                msg(data.msg);
            }
        }
    });
</script>


{include file="public/footer" }